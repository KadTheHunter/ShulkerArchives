(function(){"use strict";function t(t,e){for(var r=e.length-1;r>=0;--r)e[r].prototype=Object.create(t.prototype),e[r].prototype.constructor=e[r]}var e=this,r=e.nbtlint,a={TagBase:function(){},quotedCharRE:/[^a-zA-Z0-9._+\-]/,TagString:function(t,e){if(this.value=t,this.isKey=!!e,this.needQuotes=a.quotedCharRE.test(t),!this.needQuotes&&!e)try{a._Parser.parseNumber(t)&&(this.needQuotes=!0)}catch{}},TagNumberBase:function(t){if(t>this.maxValue)throw{error:"value_too_high",type:this.constructor,max:this.maxValue};if(t<this.minValue)throw{error:"value_too_low",type:this.constructor,min:this.minValue};this.value=t},TagByte:function(t,e){a.TagNumberBase.call(this,t),this.preferBool=!!e},TagShort:function(t){a.TagNumberBase.call(this,t)},TagInteger:function(t){a.TagNumberBase.call(this,t)},TagLong:function(t){var e=t[0];if("+"!==e&&"-"!==e||(t=t.substr(1)),"0"===t)return this.value=0;if(!/^[1-9][0-9]*$/.test(t))throw{error:"invalid_format",message:"Badly formatted TagLong string"};if(t.length>19){if("-"===e)throw{error:"value_too_low",type:a.TagLong,min:this.minValue};throw{error:"value_too_high",type:a.TagLong,max:this.maxValue}}if(t.length<19)return this.value="-"===e?e+t:t;for(var r="-"===e?this.minValueSignless:this.maxValue,i=0;i<r.length;++i)if(t[i]!==r[i]){if(t[i]<r[i])break;if("-"===e)throw{error:"value_too_low",type:a.TagLong,min:this.minValue};throw{error:"value_too_high",type:a.TagLong,max:this.maxValue}}return this.value="-"===e?e+t:t},TagFloat:function(t){t=t,t>this.maxValue&&(t="9e99"),t<this.minValue&&(t="-9e99"),this.value=t},TagDouble:function(t){t=t,t>this.maxValue&&(t="9e999"),t<this.minValue&&(t="-9e999"),this.value=t},TagCompound:function(t){if(this.pairs=[],this.map={},t)for(var e in t)this.add(e,t[e])},TagList:function(t,e){if(this.type=t||void 0,this.list=[],e)for(var r=0;r<e.length;++r)this.push(e[r])},TagArrayByte:function(t){a.TagList.call(this,a.TagByte,t)},TagArrayInt:function(t){a.TagList.call(this,a.TagInteger,t)},TagArrayLong:function(t){a.TagList.call(this,a.TagLong,t)},stringify:function(t,e,r){return null==e&&(e="\t"),r=r||{},r.capitalizeSuffix=r.capitalizeSuffix||{},a._printValue(t,e,"",!1,r)},parse:function(t){return a._Parser.parse(t)},compareAlpha:function(t,e){var r=t[0].value,a=r.toLowerCase(),i=e[0].value,o=i.toLowerCase();return a<o?-1:a>o?1:r<i?-1:r>i?1:0},compareType:function(t,e){var r=t[1].sortOrder,i=e[1].sortOrder;return r<i?-1:r>i?1:t[1].constructor!==a.TagList?0:(r=t[1].type?t[1].type.prototype.sortOrder:12,i=e[1].type?e[1].type.prototype.sortOrder:12,r<i?-1:r>i?1:0)},compareTypeAlpha:function(t,e){return a.compareType(t,e)||a.compareAlpha(t,e)},stableSorted:function(t,e){e=e||function(t,e){return t<e?-1:t>e?1:0};var r=t.map(function(t,e){return[t,e]});return r.sort(function(t,r){return e(t[0],r[0])||t[1]-r[1]}),r.map(function(t){return t[0]})},_printValue:function(t,e,r,i,o){var n;switch(t.constructor){case a.TagString:n=a._printString(t,o);break;case a.TagByte:if((0===t.value||1===t.value)&&"never"!==o.boolChoice&&("always"===o.boolChoice||t.preferBool)){n=t.value?"true":"false";break}case a.TagShort:case a.TagInteger:case a.TagLong:case a.TagFloat:case a.TagDouble:n=a._printNumber(t,o);break;case a.TagCompound:return a._printCompound(t,e,r,i,o);case a.TagList:case a.TagArrayByte:case a.TagArrayInt:case a.TagArrayLong:return a._printList(t,e,r,i,o)}return i&&!o.deflate&&(n=" "+n),n},_printString:function(t,e){if(t.needQuotes||(t.isKey?e.quoteKeys:!e.unquoteStrings)){var r;if("onlyDouble"===e.quoteChoice)r='"';else if("onlySingle"===e.quoteChoice)r="'";else{var a=t.value.split('"').length-t.value.split("'").length;r=a<0?'"':a>0?"'":"preferSingle"===e.quoteChoice?"'":'"'}return r+t.value.replace(/\\/g,"\\\\").replace('"'===r?/"/g:/'/g,"\\$&")+r}return t.value},_printNumber:function(t,e){var r=e.capitalizeSuffix[t.suffix];return null==r&&(r=e.capitalizeSuffix.default),t.value+(r?t.suffix.toUpperCase():t.suffix)},_printCompound:function(t,e,r,i,o){if(0===t.pairs.length)return o.deflate||!i?"{}":" {}";var n,s,p=r,u=(r=p+e,t.pairs),g=u.length;for(s=o.deflate?"{":i?o.nlBrackets?"\n"+p+"{\n":" {\n":"{\n",o.sort&&(u=a.stableSorted(u,o.sort)),n=0;n<g;++n)o.deflate||(s+=r),s+=a._printString(u[n][0],o)+":",s+=a._printValue(u[n][1],e,r,!0,o),n!==g-1?s+=o.deflate?",":",\n":o.deflate||(o.trailingComma&&(s+=","),s+="\n"+p);return s+"}"},_printList:function(t,e,r,i,o){if(0===t.list.length)return(o.deflate?"[":" [")+t.arrayPrefix+"]";var n,s,p=t.list[0].isPrimitive,u=t.list.length;if(!o.expandPrimitives&&p){for(s=(o.deflate?"[":" [")+t.arrayPrefix,t.arrayPrefix&&!o.deflate&&(s+=" "),n=0;n<u;++n)s+=a._printValue(t.list[n],"","",!1,o),n!==u-1&&(s+=o.deflate?",":", ");return s+"]"}var g=!p&&o.collapseBrackets,h=r,l=(r=g?h:h+e,"["+t.arrayPrefix);for(o.deflate?s=l:(s=i?o.nlBrackets?"\n"+h+l:" "+l:l,g||(s+="\n")),n=0;n<u;++n)o.deflate||0===n&&g||(s+=r),s+=a._printValue(t.list[n],e,r,!1,o),n!==u-1?s+=o.deflate?",":",\n":g||o.deflate||(o.trailingComma&&(s+=","),s+="\n"+h);return s+"]"},_Parser:{parse:function(t){this.string=t,this.cursor=0;var e=this.readCompound();if(this.skipWhitespace(),this.canRead())throw++this.cursor,this.exception("Trailing data found");return e},canRead:function(){return this.cursor<this.string.length},whitespaceRE:/^\s*/,skipWhitespace:function(){this.cursor+=this.string.substr(this.cursor).match(this.whitespaceRE)[0].length},hasElementSeparator:function(){return this.skipWhitespace(),!(!this.canRead()||","!==this.peek())&&(++this.cursor,this.skipWhitespace(),!0)},expect:function(t){this.skipWhitespace();var e=this.canRead();if(!e||this.peek()!==t){var r="Expected '"+t+"' but got '"+(e?this.peek():"<EOF>")+"'";throw++this.cursor,this.exception(r)}++this.cursor},peek:function(t){return this.string[this.cursor+(0|t)]},pop:function(){return this.string[this.cursor++]},exception:function(t,e){var r,a=Math.min(this.string.length,this.cursor);return r=a>35?"...":"",r+=this.string.substring(Math.max(0,a-35),a).replace(/\n/g,"â†µ"),r+="<--[HERE]",r=t+" at: "+r,e?{error:"parsing_error",message:r,suggestion:e}:{error:"parsing_error",message:r}},readCompound:function(){this.expect("{");var t=new a.TagCompound;for(this.skipWhitespace();this.canRead()&&"}"!=this.peek();){var e;if(this.skipWhitespace(),!this.canRead())throw this.exception("Expected a key");var r=this.peek();if(e='"'===r||"'"===r?this.readQuotedString():this.readUnquotedString(),!e)throw this.exception("Expected non-empty key");if(e in t.map)throw this.exception("Duplicate key");if(this.expect(":"),t.add(e,this.readValue()),!this.hasElementSeparator())break;if(!this.canRead())throw this.exception("Expected a key")}return this.expect("}"),t},readValue:function(){if(this.skipWhitespace(),!this.canRead())throw this.exception("Expected a value");var t=this.peek();switch(t){case"{":return this.readCompound();case"[":return'"'!==this.peek(1)&&";"===this.peek(2)?this.readArrayTag():this.readListTag();case'"':case"'":return new a.TagString(this.readQuotedString(),!1)}var e,r=this.readUnquotedString();if(!r)throw this.exception("Expected a value");try{e=this.parseNumber(r)}catch(t){return r=new a.TagString(r,!1),r.limitErr=t,r}return e||new a.TagString(r,!1)},readArrayTag:function(){this.expect("[");var t,e=this.pop();if(this.pop(),this.skipWhitespace(),!this.canRead())throw this.exception("Expected a value");switch(e){case"B":t=new a.TagArrayByte;break;case"L":t=new a.TagArrayLong;break;case"I":t=new a.TagArrayInt;break;default:throw this.exception("Invalid array type '"+e+"' found")}for(;;){if("]"===this.peek())return++this.cursor,t;var r=this.readValue();if(r.constructor!==t.type)throw this.exception("Unable to insert "+r.tagName+" into "+t.tagName);if(t.push(r),!this.hasElementSeparator())return this.expect("]"),t;if(!this.canRead())throw this.exception("Expected a value")}},readListTag:function(){if(this.expect("["),this.skipWhitespace(),this.canRead()){for(var t=new a.TagList;"]"!==this.peek();){var e=this.readValue();try{t.push(e)}catch(r){throw this.exception("Unable to insert "+e.tagName+" into ListTag of type "+t.type.prototype.tagName)}if(!this.hasElementSeparator())break;if(!this.canRead())throw this.exception("Expected a value")}return this.expect("]"),t}throw this.exception("Expected a value")},unquotedCharsRE:/^[a-zA-Z0-9._+\-]*/,readUnquotedString:function(){var t=this.string.substr(this.cursor).match(this.unquotedCharsRE)[0];return this.cursor+=t.length,t},readQuotedString:function(){for(var t=this.pop(),e=this.cursor,r="",a=!1;this.canRead();){var i=this.pop();if(a){if("\\"!==i&&i!==t)throw this.exception("Invalid escape of "+i);r+=i,e=this.cursor,a=!1}else if("\\"===i)a=!0,r+=this.string.substring(e,this.cursor-1);else if(i==t)return r+this.string.substring(e,this.cursor-1)}throw this.exception("Missing termination quote")},doubleNoSufRE:/^[-+]?(?:[0-9]+\.|[0-9]*\.[0-9]+)(?:e[-+]?[0-9]+)?$/i,doubleRE:/^[-+]?(?:[0-9]+\.?|[0-9]*\.[0-9]+)(?:e[-+]?[0-9]+)?d$/i,floatRE:/^[-+]?(?:[0-9]+\.?|[0-9]*\.[0-9]+)(?:e[-+]?[0-9]+)?f$/i,byteRE:/^[-+]?(?:0|[1-9][0-9]*)b$/i,shortRE:/^[-+]?(?:0|[1-9][0-9]*)s$/i,integerRE:/^[-+]?(?:0|[1-9][0-9]*)$/,longRE:/^([-+])?(?:0|[1-9][0-9]*)l$/i,parseNumber:function(t){return this.floatRE.test(t)?new a.TagFloat(+t.substr(0,t.length-1)):this.byteRE.test(t)?new a.TagByte(+t.substring(0,t.length-1),!1):this.longRE.test(t)?new a.TagLong(t.substring(0,t.length-1)):this.shortRE.test(t)?new a.TagShort(+t.substring(0,t.length-1)):this.integerRE.test(t)?new a.TagInteger(+t):this.doubleRE.test(t)?new a.TagDouble(+t.substring(0,t.length-1)):this.doubleNoSufRE.test(t)?new a.TagDouble(+t):"true"===t.toLowerCase()?new a.TagByte(1,!0):"false"===t.toLowerCase()?new a.TagByte(0,!0):void 0}}};for(var i in t(a.TagBase,[a.TagString,a.TagCompound,a.TagList,a.TagNumberBase]),t(a.TagList,[a.TagArrayByte,a.TagArrayInt,a.TagArrayLong]),t(a.TagNumberBase,[a.TagByte,a.TagShort,a.TagInteger,a.TagLong,a.TagFloat,a.TagDouble]),a.byID={1:a.TagByte,2:a.TagShort,3:a.TagInteger,4:a.TagLong,5:a.TagFloat,6:a.TagDouble,7:a.TagArrayByte,8:a.TagString,9:a.TagList,10:a.TagCompound,11:a.TagArrayInt,12:a.TagArrayLong},a.byID)a.byID[i].prototype.tagID=0|i;if(a.TagByte.prototype.tagName="TAG_Byte",a.TagShort.prototype.tagName="TAG_Short",a.TagInteger.prototype.tagName="TAG_Int",a.TagLong.prototype.tagName="TAG_Long",a.TagFloat.prototype.tagName="TAG_Float",a.TagDouble.prototype.tagName="TAG_Double",a.TagString.prototype.tagName="TAG_String",a.TagList.prototype.tagName="TAG_List",a.TagCompound.prototype.tagName="TAG_Compound",a.TagArrayByte.prototype.tagName="TAG_Byte_Array",a.TagArrayInt.prototype.tagName="TAG_Int_Array",a.TagArrayLong.prototype.tagName="TAG_Long_Array",a.TagByte.prototype.suffix="b",a.TagShort.prototype.suffix="s",a.TagInteger.prototype.suffix="",a.TagLong.prototype.suffix="l",a.TagFloat.prototype.suffix="f",a.TagDouble.prototype.suffix="d",a.TagList.prototype.arrayPrefix="",a.TagArrayByte.prototype.arrayPrefix="B;",a.TagArrayInt.prototype.arrayPrefix="I;",a.TagArrayLong.prototype.arrayPrefix="L;",a.TagByte.prototype.minValue=-128,a.TagByte.prototype.maxValue=127,a.TagShort.prototype.minValue=-32768,a.TagShort.prototype.maxValue=32767,a.TagInteger.prototype.minValue=-2147483648,a.TagInteger.prototype.maxValue=2147483647,a.TagLong.prototype.minValue="-9223372036854775808",a.TagLong.prototype.maxValue="9223372036854775807",a.TagLong.prototype.minValueSignless="9223372036854775808",a.TagDouble.prototype.minValue=-Number.MAX_VALUE,a.TagDouble.prototype.maxValue=Number.MAX_VALUE,"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Float32Array&&"undefined"!=typeof Int32Array){var o=new ArrayBuffer(4),n=new Float32Array(o),s=new Int32Array(o);s[0]=2139095039,a.TagFloat.prototype.minValue=-n[0],a.TagFloat.prototype.maxValue=n[0]}else a.TagFloat.prototype.minValue=-3.4028234663852886e38,a.TagFloat.prototype.maxValue=3.4028234663852886e38;a.TagString.prototype.sortOrder=0,a.TagByte.prototype.sortOrder=1,a.TagShort.prototype.sortOrder=2,a.TagInteger.prototype.sortOrder=3,a.TagLong.prototype.sortOrder=4,a.TagFloat.prototype.sortOrder=5,a.TagDouble.prototype.sortOrder=6,a.TagCompound.prototype.sortOrder=7,a.TagArrayByte.prototype.sortOrder=8,a.TagArrayInt.prototype.sortOrder=9,a.TagArrayLong.prototype.sortOrder=10,a.TagList.prototype.sortOrder=11,a.TagString.prototype.isPrimitive=!0,a.TagNumberBase.prototype.isPrimitive=!0,a.TagCompound.prototype.isPrimitive=!1,a.TagList.prototype.isPrimitive=!1,a.TagCompound.prototype.add=function(t,e){if(t in this.map)throw{error:"duplicate_key",message:"Duplicate key: "+a._printString(new a.TagString(t,!0),{})};this.pairs.push([new a.TagString(t,!0),e]),this.map[t]=e},a.TagCompound.prototype.remove=function(t){if(!(t in this.map))return null;delete this.map[t];for(var e=this.pairs.length-1;e>=0;--e)if(this.pairs[e][0].value===t)return this.pairs.splice(e,1)[0][1];throw{error:"inconsistent_state",message:"The internal state of this compound is borked. Did you mess with it?"}},a.TagList.prototype.push=function(t){if(this.type=this.type||t.constructor,t.constructor!==this.type)throw{error:"invalid_tag_type",message:"Cannot insert "+t.constructor.name+" into a list of type "+this.type.name};this.list.push(t)},a.noConflict=function(){return e.nbtlint=r,a},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports.nbtlint=a):e.nbtlint=a}).call(this);